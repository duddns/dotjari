<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:widget="http://wzdapi.com/widget/" lang="ko">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="apiVersion" content="1.1" />
<meta name="author" content="돗자리 프로젝트" />
<meta name="website" content="http://wzdwoc.springnote.com/pages/719862" />
<meta name="description" content="내가 원하는 채용정보를 간편하게 검색하세요~" />
<meta name="version" content="1.5" />
<meta name="autoRefresh" content="1" />
<title>내일검색</title>
<link rel="icon" type="image/gif" href="images/favicon.gif" />
    
<widget:preferences>
    <widget:preference name="query" type="text" label="검색어" defaultValue="프로그래머" />
    <!-- <widget:preference name="region" type="list" label="지역">
        <widget:option label="전체" value="" />
        <widget:option label="서울" value="11" />
        <widget:option label="부산" value="12" />
        <widget:option label="대구" value="13" />
        <widget:option label="인천" value="14" />
        <widget:option label="광주" value="15" />
        <widget:option label="대전" value="16" />
        <widget:option label="울산" value="17" />
        <widget:option label="경기" value="18" />
        <widget:option label="강원" value="19" />
        <widget:option label="충북" value="20" />
        <widget:option label="충남" value="21" />
        <widget:option label="전북" value="22" />
        <widget:option label="전남" value="23" />
        <widget:option label="경북" value="24" />
        <widget:option label="경남" value="25" />
        <widget:option label="제주" value="26" />
        <widget:option label="특구" value="40" />
        <widget:option label="전국" value="59" />
        <widget:option label="해외" value="98" />
        <widget:option label="기타" value="99" />
    </widget:preference>
    <widget:preference name="career" type="list" label="경력">
        <widget:option label="전체" value="" />
        <widget:option label="경력무관" value="0" />
        <widget:option label="신입" value="1" />
        <widget:option label="1~2년" value="2" />
        <widget:option label="2~3년" value="3" />
        <widget:option label="3~5년" value="4" />
        <widget:option label="5~10년" value="5" />
        <widget:option label="10년 이상" value="6" />
    </widget:preference>
    <widget:preference name="employType" type="list" label="채용형태">
        <widget:option label="전체" value="" />
        <widget:option label="정규직" value="1" />
        <widget:option label="계약직" value="2" />
        <widget:option label="병역특례" value="3" />
        <widget:option label="인턴" value="4" />
        <widget:option label="파견대행" value="5" />
        <widget:option label="헤드헌팅" value="6" />
        <widget:option label="아르바이트" value="7" />
        <widget:option label="프리랜서" value="8" />
        <widget:option label="생활직" value="9" />
        <widget:option label="기타" value="98" />
    </widget:preference>
    <widget:preference name="closeDate" type="list" label="채용마감일">
        <widget:option label="전체" value="" />
        <widget:option label="1주" value="weekly" />
        <widget:option lebel="1개월" value="monthly" />
    </widget:preference>
    <widget:preference name="listCount" type="range" label="리스트 개수" defaultValue="3" step="1" min="3" max="10" /> -->
</widget:preferences>
    
<style type="text/css">
    /*<![CDATA[*/
    div.container {
        font-size: 12px; 
        font-family:"굴림", "돋움", Seoul, "한강체"; 
        color:#464646; 
        line-height: 16px;
        border: 1px solid #EBEBEB;
    }
    
    div.logo {
        margin: 7px 0 3px 7px;
    }
    
    div.logo img {
        border: none;
    }
    
    form.searchForm fieldset {
        border: none;
        border-bottom: 1px solid #EBEBEB;
        background: #05A0BA;
        height: 26px;
    }
    
    form.searchForm fieldset input {
        vertical-align: middle;
        margin-top: 3px;
        fload: left;
    }
    
    form.searchForm fieldset input.query {
        width: 115px; 
        height: 18px; 
        border: 1px solid #CCCCCC; 
        font-size: 11px;
        line-height: 1.5;
    }

    /* WZDList1 modified */

    div.resultBox ul.WZDList1 li div.entry {
        padding-left: 8px;
    }
    
    div.resultBox ul.WZDList1 li h6 {
        padding: 5px 0 0 12px;
        background: url(images/bullet2.gif) no-repeat 2px 10px;
        /* 한줄로만 보이기 */
        height: 20px;
        line-height: 20px;
        overflow: hidden;
    }
    
    div.resultBox ul.WZDList1 li h6 a b { /* 검색어 강조 */
        color: #fff;
        background: #144066;
        padding: 2px 2px;
    }
    
    div.resultBox ul.WZDList1 li p.d2 {
        padding: 3px 0 4px 12px;
        /* 한줄로만 보이기 */
        height: 15px;
        line-height: 17px;
        overflow: hidden;
    }
    
    /* 하단 페이지네이션  */

    div.pagerContainer {
        height: 15px;
        padding: 10px;
    }
    
    div.innerPagerContainer {
        width: 155px;
        margin: 0 auto;
    }

    div.pager {
        float: left;
    }
    
    div.more {
        float: right;
    }
    
    div.more a {
        font-weight: bloder;
        color: #00688E;
        text-decoration: none;
    }
    
    /* ie hack */
    form.searchForm fieldset {
        /height: 30px;
    }
    /*]]>*/
</style> 
<script type="text/javascript" src="http://wzdapi.com/widget/emulator.js"></script>
<script type="text/javascript"> 
//<![CDATA[
    var Dotjari = {
    
        _listCount: 3,
        
        _query: '',
        _region: '',
        _career: '',
        _employType: '',
        _closeDate: '',
        
        _pager: null,
        
        _maxPage: 0,
        _currentPage: 1,
        
        _elements: [],
        
        
        init: function() {
            
            this._initPref();
            this._initVar();
            this._initEl();
        },
        
        /*
         * 위젯 설정 내용을 가져와서 변수에 저장합니다.
         */
        _initPref: function() {
        
            this._query = widget.getValue('query');

            this._region = widget.getValue('region');
            this._career = widget.getValue('career');
            this._employType = widget.getValue('employType');
            this._closeDate = widget.getValue('closeDate');
            this._listCount = widget.getValue('listCount');
            
            // 설정값이 없을 경우에 사용할 기본값
            this._region = this._region ? this._region : '';
            this._career = this._career ? this._career : '';
            this._employType = this._employType ? this._employType : '';
            this._closeDate = this._closeDate ? this._closeDate : '';
            this._listCount = this._listCount ? this._listCount : 3;
        },
        
        /*
         * 기본 변수를 초기화 합니다.
         */
        _initVar: function() {
        
            this._pager = null;
        
            this._maxPage = 0;
            this._currentPage = 1;
        },
        
        /*
         * DOM Element를 캐싱하기 위해 지역변수에 저장합니다.  
         */
        _initEl: function() {

            this._elements.error = UWA.$element(widget.body.getElementsByClassName('error')[0]);
            this._elements.errorColse = UWA.$element(widget.body.getElementsByClassName('errorClose')[0]);
            this._elements.errorMessage = UWA.$element(widget.body.getElementsByClassName('errorMessage')[0]);
            
            this._elements.logo_title = UWA.$element(widget.body.getElementsByClassName('logo_title')[0]);
            
            this._elements.searchForm = UWA.$element(widget.body.getElementsByClassName('searchForm')[0]);
            this._elements.query = UWA.$element(widget.body.getElementsByClassName('query')[0]);
            
            this._elements.resultBox = UWA.$element(widget.body.getElementsByClassName('resultBox')[0]);
            this._elements.WZDList1 = UWA.$element(widget.body.getElementsByClassName('WZDList1')[0]);
            
            this._elements.pager = UWA.$element(widget.body.getElementsByClassName('pager')[0]);
            this._elements.moreBtn = UWA.$element(widget.body.getElementsByClassName('moreBtn')[0]);
            
            this._elements.closeDate = UWA.$element(widget.body.getElementsByClassName('closeDate')[0]);

            // 검색창에 기본 검색어 입력
            this._elements.query.value = this._query;
            
            this._initElEvents();
        },

        /*
         * HTML event를 등록합니다.
         *
         */
        _initElEvents: function() {
        
            this._elements.searchForm.onsubmit = function() {

                this.query = this.elements.query.value;
                if ('' == this._query) {
                    alert('검색어를 입력해 주세요.');
                    this._elements.query.focus();
                    return;
                }
                this._initVar();
                this.load();
                return false;
            }.bind(this);
        },

        /*
         * 저장된 검색조건으로 검색 요청을 보냅니다.
         */
        load: function() {
        
            if ('' == this._query) {
                return;
            }
            
            var url = '/proxy/naeilapi.incruit.com/api/?method=search&apikey=A45F959AEA04D2799C4C1824DF101FE7FC0EB507&out=xml&';
            url += 'q=' + $H(this._query.toQueryParams()).toQueryString();
            url += '&count=' + this._listCount + '&start=' + ((this._currentPage - 1) * this._listCount);
            url += '&rgn1=' + this._region;
            url += '&crr=' + this._career;
            url += '&epty=' + this._employType;
            url += '&closeDate=' + this._closeDate;
            UWA.Data.getXml(url, function(res) {
                this._render(res);
            }.bind(this));
        },
        
        /*
         * 검색 결과를 화면에 표시합니다.
         */
        _render: function(res) {
        
            this._elements.WZDList1.show();
            
            // 리스트 만듦
            this._renderList(res);

            // pager 만듦
            var totalCount = this._getNodeValue(res, 'TotalCount');
            this._maxPage = Math.ceil(totalCount / this._listCount);
            this._renderPager();
            
            this._renderMore();
        },
        
        /*
         * 총 검색 건수와 한 화면에 표시할 갯수를 이용해서 pagenation을 구성합니다.
         */
        _renderPager: function() {
        
            if (pager) {
                return;
            }
        
            this._elements.pager.innerHTML = '';
            
            var pager = new UWA.Controls.Pager();
            pager.setMaxPageNumber(this._maxPage);
            pager.selectPage(this._currentPage);
            pager.onChange = function(pageNo) {
                this._currentPage = pageNo;
                this.load();
            }.bindAsEventListener(this);
            pager.appendTo(this._elements.pager);
            
            this._pager = pager;
        },

        _renderMore: function() {

            this._elements.moreBtn.href = 'http://naeil.incruit.com/search/?q=' + this._query;
        },
        
        /*
         * 검색 내용을 화면에 표시합니다.
         */
        _renderList: function(res) {
        
            this._elements.resultBox.show();
            
            // 결과창 초기화
            this._elements.WZDList1.innerHTML = '';
            
            var items = res.getElementsByTagName('item');
            var length = items.length;
            if (0 == length) {
                this._elements.WZDList1.innerHTML = '검색 결과가 없습니다.';
                return;
            }
            
            for (var i = 0; i < length; i++) {
            
                var listEl = widget.createElement('li');
                if (0 != i % 2) {
                    listEl.className = 'even';
                }
                
                var title = this._getNodeValue(items[i], 'Job_Title');
                var url = this._getNodeValue(items[i], 'Link_Url');
                var company = this._getNodeValue(items[i], 'Comp_Nm');
                var region = this._getNodeValue(items[i], 'Region_Nm');
                var employType = this._getNodeValue(items[i], 'Employ_Ty_Nm');
                var careerType = this._getNodeValue(items[i], 'Career_Nm');
                var closeDate = this._getNodeValue(items[i], 'Cl_Invite_Close_Dt');
                var employLimit = this._getNodeValue(items[i], 'Employ_Limit');
                
                if (0 == closeDate.length) {
                    closeDate = new Date().getFullYear() + '년'; 
                } else {
                    var year = closeDate.substring(0, 4);
                    var month = closeDate.substring(4, 6);
                    var day = closeDate.substring(6, 8);
                    closeDate = year ? year + '년 ' : '';
                    closeDate += month ? month + '월 ' : '';
                    closeDate += day ? day + '일' : '';
                }
                
                employLimit = employLimit ? employLimit : '채용시까지';
                
                var html = [];
                html.push('<div class="entry"><h6><a class="sub1" target="_blank" href="', url, '"><span>');
                html.push(title, '</span></a></h6><p class="d2">');
                html.push(company, ' / ', region, ' / ', employType, ' / ', careerType, ' / ', closeDate, ' / ', employLimit, '</p></div>');
                
                listEl.innerHTML = html.join('');

                var tooltipText = this._getNodeValue(items[i], 'Job_Cont');
                if(tooltipText.length > 1) { 
                    // 설명이 없는경우 툴팁 안띄움
                    UWA.Utils.setTooltip(listEl, tooltipText, 240);
                }
                
                this._elements.WZDList1.appendChild(listEl);
            }
        },
        
        
        _getNodeValue: function(node, tag) {
        
            return node.getElementsByTagName(tag)[0].firstChild.data;
        }
    };

    widget.onLoad = function() {
        Dotjari.init();
        Dotjari.load();
    };
//]]>
</script>
</head>

<body>
    <div class="container">
        <div class="logo"><a href="http://naeil.incruit.com/" title="내일검색" target="_blank"><img alt="내일검색" src="http://img.incruit.com/naeil/wedget/bi_naeil_widget.gif" /></a></div>
        <div class="error" style="display:none;">
            <button class="errorClose" type="button"><span>닫기</span></button>
            <p class="errorMessage"></p>
        </div>
        <p class="searchText"></p>
        <form class="searchForm" style="text-align:center;">
            <fieldset>
                <input type="text" name="query" class="query" />
                <input type="image" class="searchBtn" src="http://img.incruit.com/naeil/wedget/btn_default_search.gif" />
            </fieldset>
        </form>
        <div class="resultBox" style="display:none;"> 
            <div class="searchResult"><ul class="WZDList1"></ul></div>
            
            <div class="pagerContainer">
                <div class="innerPagerContainer">
                    <div class="pager"></div>
                    <div class="more"><a class="moreBtn" href="http://naeil.incruit.com/search/?q=" title="more" target="_blank">more</a></div>
                </div>
            </div>
        </div>
        <div style="clear:both;" />
    </div>
</body> 
</html> 
